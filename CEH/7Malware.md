
# 7.Malware

## 1. Trojans

### Remote Access Trojans (RATs)
  
  - build by "njRAT"
  
### Hide a Trojan
  
  - FUDs(fully undetectable crypters)
  - using **SwayzCryptor**
    - test by https://www.virustotal.com after hiding
    
### Create a server
  
  - by **ProRat**
    - written in C
    - allow users to control computers remotely
  - by **Theef RAT Trojan**
    - written in Delphi

## 2. Virus
### Create a Virus
  - by **JPS Virus Maker**
    
## 3. Static Malware Analysis
  
### Online Malware Scanning
  
  - **VirusTotal**
    - https://www.virustotal.com
  - Hybrid Analysis (https://www.hybrid-analysis.com)
  - Cuckoo Sandbox (https://cuckoosandbox.org)
  - Jotti (https://virusscan.jotti.org)
  - Valkyrie Sandbox (https://valkyrie.comodo.com)
  
### String Search
  
  - ```Various strings that could represent the malicious intent of a program```
  - FLOSS (https://www.fireeye.com)
  - Strings (https://docs.microsoft.com)
  - Free EXE DLL Resource Extract (http://www.resourceextract.com)
  - FileSeek (https://www.fileseek.ca)
  
### Identify packaging and obfuscation
  
  - ``` Attackers often use packing and obfuscation or a packer to compress, encrypt, or modify a malware executable file to avoid detection. ```
  - ``` When the user executes a packed program, it also runs a small wrapper program to decompress the packed file, and then runs the unpacked file. ```
  - **PEid**
    - on Windows, can identify signatures associated with over 600 different packers and compilers.
  - Macro_Pack (https://github.com)
  - UPX (https://upx.github.io)
  - ASPack (http://www.aspack.com)

### Portable Executable (PE) Information
  
  - PE Explorer
    - PE Explorer gives you the power to look inside these PE binary files, perform static analysis, reveal a lot of information about the function of the executable, and collect as much information about the executable file as possible, without executing it.
  - Portable Executable Scanner (pescan) (https://tzworks.net)
  - Resource Hacker (http://www.angusj.com)
  - PEView (https://www.aldeid.com)

### Identify file dependencies
  - dlls
    - **Kernel32.dll** Core functionality such as access and manipulation of memory, files and hardware.
    - **Advapi32.dll** Provides access to advanced core Windows components such as the Service Manager and Registry.
    - **User32.dll User** interface components such as buttons, scrollbars and components for controlling and responding to user actions.
    - **Gdi32.dll** Functions for displaying and manipulating graphics.
    - **Ntdll.dll** Interface to the windows kernel.
    - **WSock32.dll & Ws2_32.dll** Networking DLLs help to connect to a network or network related tasks.
    - **Wininet.dll** Supports higher-level networking functions.
  
  - Dependency Walker
    - ``` The Dependency Walker tool lists all dependent modules of an executable file and builds hierarchical tree diagrams. ```
  - Dependency-check (https://jeremylong.github.io)
  - Snyk (https://snyk.io)
  - Hakiri (https://hakiri.io)
  - RetireJS (https://retirejs.github.io)

### Malware Disassembly
  - IDA
  - OllyDbg
  - Ghirda (https://ghidra-sre.org)
  - Radare2 (https://rada.re)
  - WinDbg (http://www.windbg.org)
  - ProcDump (https://docs.microsoft.com)

## 4. Dynamic Malware Analysis
  
  - also known as behavioral analysis
  - reveals information such as 
    - domain names, 
    - file path locations, 
    - created registry keys, 
    - IP addresses, 
    - additional files, 
    - installation files, 
    - DLL and linked files located on the system or network.
  - System Baselining
    - Taking snapshot
  - Host Integrity Monitoring
    - studying the changes
    
### Post Monitoring
  - TCP view (windows)
    - Tcpvcon, the command line version
  - CurrPorts (windows) (https://www.nirsoft.net)
  - Port Monitor (https://www.port-monitor.com)
  - TCP Port Monitoring (https://www.dotcom-monitor.com)
  - PortExpert (http://www.kcsoftwares.com)

### Process Monitoring
  - Process Monitor (windows)
    - Time, Process Name, PID, Operation, Path, Result, Detail
    - Process Tab: PID, Parent ID, User, Modules, Started, Ended...
    - Stack Tab: Frame, Module, Location, Address, Path
  - Process Explorer (https://docs.microsoft.com)
  - OpManager (https://www.manageengine.com)
  - Monit (https://mmonit.com)
  - ESET SysInspector (https://www.eset.com)

### Registry Monitoring
  When an attacker installs a type of malware on the victimâ€™s machine, it generates a registry entry.\
  Scanning for suspicious registries will help to detect malware.
  
  - Regshot (windows)
    - 1st shot, 2nd shot, compare
  - jv16 PowerTools
    - Main tools -> Clean and SpeedUp My Computer -> Registry Errors -> Delete
    - This deletes all unwanted or harmful registries, logs, temporary files, and other identified files, ensuring the safety of your computer.
   - Reg Organizer (https://www.chemtable.com)
   - Registry Viewer (https://accessdata.com)
   - RegScanner (https://www.nirsoft.net)
   - Registrar Registry Manager (https://www.resplendence.com)

### Windows Services Monitoring
  Malicious services are invisible.
  - Malware may also employ rootkit techniques to manipulate the following registry keys to hide their processes and services.\
  - ``` HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services ```
  
  Windows service Manager (SrvMan)
  - A Windows service monitoring tool
  - Which detect changes in services and scan for suspicious Windows services.
  - show: Internal name, State(stopped/running), Type(driver/win32/FS driver/shared), Display name, Stat type, Executable
  - for every service, you can: show properties, stop, restart, delete
  
  Other windows services monitoring tools:
  - Advanced Windows Service Manager (https://securityxploded.com)
  - Process Hacker (https://processhacker.sourceforge.io)
  - Netwrix Service Monitor (https://www.netwrix.com)
  - AnVir Task Manager (https://www.anvir.com)

### Startup Program Monitoring
  > Attackers make many malicious programs such as Trojans and worms in such a way that they are executed during startup.
  
  Autoruns for Windows.
  - display all processes, dll, services.
  - Logon tab: view applications run automatically during login.
  - Explorer tab: explorer applications run automatically during system startup.
  - Services tab: services run automatically at system startup.
  - Drivers tab: application drivers run automatically at system startup.
    - size, version, time
  - KnowDLLs tab: known DLLs start automatically at system startup.
  
  WinPatrol
  - Startup Programs.
  - IE Helpers: It shows all toolbars and links loaded by IE or other windows component.
  - Services: display the installed services on your system. 
  - File Types: view the programs associated with a file.
  - Active Tasks: view the current tasks running on your computer.
  
  Other tools:
  - Autorun Organizer (https://www.chemtable.com)
  - Quick Startup (https://www.glarysoft.com) 
  - StartEd Pro (http://www.outertech.com)
  - Chameleon Startup Manager (http://www.chameleon-managers.com)

 ### Installation Monitoring
  > detect hidden and background installations that malware performs.\
  > When the system/users (un)install any software appplication, it may leave traces of the application data on the system.
  
  Mirekusoft Install Monitor
  - allows you to uninstall programs completely.
  - detailed information how much disk space, CPU, and memory your programs are using. 
  - information about how often you use different programs.
  - detect startup

  Other Intallation monitoring tools:
  - SysAnalyzer (https://www.aldeid.com)
  - Advanced Uninstaller PRO (https://www.advanceduninstaller.com)
  - REVO UNINSTALLER PRO (https://www.revouninstaller.com)
  - Comodo Programs Manager (https://www.comodo.com)

### File and Folder Monitoring
  > Malware can modify system files and folders to save information, hide program code or malicious strings.
  
  File and folder integrity checking tools:
  - PA File Sight
  - Tripwire File Integrity and Change Manager (https://www.tripwire.com)
  - Netwrix Auditor (https://www.netwrix.com)
  - Verisys (https://www.ionx.co.uk)
  - CSP File Integrity Checker (https://www.cspsecurity.com)
  
### Device driver monitoring
  > user downloads infected drivers from untrusted sources, the system installs malware along with the device drivers.
  
  DriverView
  - list: Driver Name, Address, End Address, Size, Load Count, Index, File Type, Description, Version, Company, ProductName
  - list: Modified Date, Created Date, Filename, File Attributes, Service Name, Service Display Name, Digital Signature

  Driver Reviver
  - see Driver Status: Outdated / Up to date.
  - can create Backup or Restore the system drivers.
  
  Other Driver Monitoring tools:
  - Driver Booster (https://www.iobit.com)
  - Driver Easy (https://www.drivereasy.com) 
  - Driver Fusion (https://treexy.com)
  - Driver Genius (http://www.driver-soft.com)
  
### DNS Monitoring
  Every DNS query:
  - Host Name, Port Number.
  - Query ID, Request Type(A, AAAA, NS, MX, other).
  - Request time, Response time.
  - Duration, Response Code, Number of records.
  - the content of the returned DNS records.
  
  Export: CSV, tab-delimited, XML, HTML, txt.
  
  DNSQuerySniffer.
  - WinPcap Packet Capture Driver
  - In real-time, attackers will use malicious applications like DNSChanger to change the DNS of the target machine.
  - The DNS sniffer can detect it.
  
  Other tools:
  - DNSstuff (https://www.dnsstuff.com)
  - DNS Lookup Tool (https://www.ultratools.com)
  - Sonar Lite (https://constellix.com)
